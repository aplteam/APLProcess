<!DOCTYPE html>
<html lang="en">
<head>
<title>Coverage</title>
<meta charset="utf-8"/>
<style>
@media screen{
    html {background-color: #FFFFF0;}
body {
    font-size: 16px;
    font-family : Verdana, "Bitstream Vera Sans", "DejaVu Sans", Tahoma, Geneva, Arial, Sans-serif;
    margin: 1em;
}
th, td {padding: 5px 10px;}
th {text-align: left;}
h1, h2, h3, h4, h5, h6 {color: #424242;}
h1 {font-size: 22px;}
h2 {font-size: 18px; margin-top: 2em; margin-bottom:0.3em;}
tbody tr:nth-child(even) {background-color: #F0F0F0;}
tbody tr:nth-child(odd) {background-color: #FAFAFA;}
th {background-color: #E6E6E6;color: #424242;}
table {border: silver 1px solid; font-size: 14px;font-family: APLFont, monospace;}
code , code a {font-size: 14px; font-family: APLFont, monospace;}
code.header {
    font-size: 16px; 
    font-family: APLFont, monospace; 
    margin: 1.5em 0.5em 0 0.5em; 
    padding:0;
    display: block;
}
div.code-block {
    border: 1px silver dashed;
    background-color: #F2F2F2;
    display: block;
    margin: 0.5em 0.5em 0.5em 0.5em;
    padding: 0.5em;
}
div.code-block.missing {
    background-color: #fa605254;
}
div.code-block code {display: block; white-space: pre-wrap; margin:0; padding:0; word-wrap: break-word;}
.emphasize { font-weight: 800;}
ul li, ol li {margin: 0.7em 0.2em;}
.float-right {float:right;}
.no-underline {    text-decoration :none;}
.top-links {font-size:20px; padding-left: 0.6em;}
.align-right {text-align: right;}
#footer hr {margin-top:1.5em;}
#footer p {margin-top:5px; padding-top:0; font-size: 9px;}
@font-face {
        font-family: "APLFont";
    src:
        local("APL385 Unicode"),
        url("https://misc.aplteam.com/apl385.ttf") format("truetype");
}
.info {border: 1px silver dashed; background-color: #F2F2F2;margin: 0.5em; padding: 0.5em;}
}
@media print{@page {size: portrait}
@page {
    margin: 1cm 1cm 1cm 1.75cm;
    @bottom-right {
        content: counter(page) " / " counter(pages);
  }
}
body {
    font: 12pt "Times New Roman", Times, serif;
    line-height: 1.2;
     /* CSS3 filter, at the moment Webkit only. Prefix it for future implementations */
    -webkit-filter: grayscale(100%);
    filter: grayscale(100%); /* future-proof */
}
h1 {font-size: 18pt;}
h2 {font-size: 16pt; margin-top: 10pt; margin-bottom: 3pt;}
th, td {padding: 2pt 3pt;}
th {text-align: left;background-color: #DBDBDB;}
tbody tr:nth-child(odd) {background-color: #EDEDED;}
table {
    color-adjust: exact !important;
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
    font-size: 8pt;
    font-family: APLFont, monospace;
}
div.keep-together {break-inside: avoid; break-before:auto;}
table {border: silver 1pt solid;}
code , code a {font-size: 8pt; font-family: APLFont, monospace;}
code.header {
    font-size: 8pt;
    font-family: APLFont, monospace;
    margin: 7pt 3pt 0 10pt;
    padding:0;
    display: block;
}
div.code-block {
    border: 1pt silver dashed;
    background-color: #F2F2F2;
    display: block;
    margin: 4pt 4pt 4pt 4pt;
    padding: 4pt;
}
div.code-block code {display: block; white-space: pre-wrap; margin:0; padding:0; word-wrap: break-word;}
.emphasize { font-weight: 800;}
a {text-decoration: none;color: black;}
ul li, ol li {margin: 8pt 3pt;}
.no-print {display:none;}
.align-right {text-align: right;}
#footer hr {margin-top:1.5em;}
#footer p {margin-top:5pt; padding-top:0; font-size: 6pt;}
@font-face {
        font-family: "APLFont";
    src:
        local("APL385 Unicode"),
        url("https://misc.aplteam.com/apl385.ttf") format("truetype");
}
.info {border: 1px silver dashed; background-color: #F2F2F2;margin: 8px; padding: 8px;}
}
</style>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/jq-3.6.0/dt-1.11.2/b-2.0.0/b-print-2.0.0/fh-3.1.9/r-2.2.9/datatables.min.css"/>
<script type="text/javascript" src="https://cdn.datatables.net/v/dt/jq-3.6.0/dt-1.11.2/b-2.0.0/b-print-2.0.0/fh-3.1.9/r-2.2.9/datatables.min.js"></script>
</head>
<body>
<h1 id="top">Coverage Report</h1>
<p>Watched: 27 fns/opr within <code>#.APLProcess.APLProcess</code></p>
<p>The test suite was executed once:</p>
<table>
<thead>
<tr><th>Executed at</th><th>APLVersion</th><th>Memory (MB)</th></tr>
</thead>
<tbody>
<tr><td>2025-04-22 10:16:32</td><td>Windows-64 ⋄ 19.0.51432.0 ⋄ W ⋄ Development ⋄ Unicode</td><td>112</td></tr>
</tbody>
</table>
<p>Overall 57% of the testable code is covered.</p>
<p>(Comment lines, empty lines, all <code>:End</code>* lines etc. are ignored)</p>
<p>15 of the fns/opr are 100% covered.</p>
<div id="partly-covered" class="keep-together">
<table id="percent">
<thead>
<tr><th style="text-align:left;">Function/Operator</th><th style="text-align:left;">Lines not executed</th><th style="text-align:left;">Coverage</th><th style="text-align:right;">≢</th></tr>
</thead>
<tbody>
<tr class="uncovered"><td><a href="#listing_1" title="Link to listing">#.APLProcess.APLProcess.set_Wait</a></td><td>1, 2</td><td>0</td><td>2</td></tr>
<tr class="uncovered"><td><a href="#listing_2" title="Link to listing">#.APLProcess.APLProcess.get_LogFilename</a></td><td>1</td><td>0</td><td>1</td></tr>
<tr class="uncovered"><td><a href="#listing_3" title="Link to listing">#.APLProcess.APLProcess.History</a></td><td>14</td><td>0</td><td>1</td></tr>
<tr class="uncovered"><td><a href="#listing_4" title="Link to listing">#.APLProcess.APLProcess.GetLog</a></td><td>2, 3, 4</td><td>0</td><td>3</td></tr>
<tr class="uncovered"><td><a href="#listing_5" title="Link to listing">#.APLProcess.APLProcess.GetPID</a></td><td>3</td><td>0</td><td>1</td></tr>
<tr><td><a href="#listing_6" title="Link to listing">#.APLProcess.APLProcess.Start</a></td><td>67←≢7,24,26,40-44,46-49,51-55,57-58,60,62-66,68-70,72-78,80-86,88-93,95,97-99,101-102,104-105,107-112,114,116-118,120</td><td>29</td><td>94</td></tr>
<tr><td><a href="#listing_7" title="Link to listing">#.APLProcess.APLProcess.GetCurrentExecutable</a></td><td>8←≢6-9,12-14,16</td><td>38</td><td>13</td></tr>
<tr><td><a href="#listing_8" title="Link to listing">#.APLProcess.APLProcess.Version</a></td><td>9</td><td>67</td><td>3</td></tr>
<tr><td><a href="#listing_9" title="Link to listing">#.APLProcess.APLProcess.get_ExitCode</a></td><td>8, 12</td><td>78</td><td>9</td></tr>
<tr><td><a href="#listing_10" title="Link to listing">#.APLProcess.APLProcess.GetRuntimeName</a></td><td>10</td><td>80</td><td>5</td></tr>
<tr><td><a href="#listing_11" title="Link to listing">#.APLProcess.APLProcess.SourcePath</a></td><td>6</td><td>83</td><td>6</td></tr>
<tr><td><a href="#listing_12" title="Link to listing">#.APLProcess.APLProcess.make1</a></td><td>18</td><td>97</td><td>30</td></tr>
<tr class="fullyCovered"><td><a href="#listing_13" title="Link to listing">#.APLProcess.APLProcess.get_Wait</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_14" title="Link to listing">#.APLProcess.APLProcess.set_WindowsStyle</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_15" title="Link to listing">#.APLProcess.APLProcess.get_WindowsStyle</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_16" title="Link to listing">#.APLProcess.APLProcess.set_LogFilename</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_17" title="Link to listing">#.APLProcess.APLProcess.set_ExitCode</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_18" title="Link to listing">#.APLProcess.APLProcess.make_common</a></td><td></td><td>100</td><td>4</td></tr>
<tr class="fullyCovered"><td><a href="#listing_19" title="Link to listing">#.APLProcess.APLProcess.Close</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_20" title="Link to listing">#.APLProcess.APLProcess.Close_</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_21" title="Link to listing">#.APLProcess.APLProcess.CreateParms</a></td><td></td><td>100</td><td>11</td></tr>
<tr class="fullyCovered"><td><a href="#listing_22" title="Link to listing">#.APLProcess.APLProcess.WaitForKill</a></td><td></td><td>100</td><td>10</td></tr>
<tr class="fullyCovered"><td><a href="#listing_23" title="Link to listing">#.APLProcess.APLProcess.HasExited</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_24" title="Link to listing">#.APLProcess.APLProcess.KillItself</a></td><td></td><td>100</td><td>3</td></tr>
<tr class="fullyCovered"><td><a href="#listing_25" title="Link to listing">#.APLProcess.APLProcess.GetDefaultDseFilename</a></td><td></td><td>100</td><td>3</td></tr>
<tr class="fullyCovered"><td><a href="#listing_26" title="Link to listing">#.APLProcess.APLProcess.IsNetCore</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_27" title="Link to listing">#.APLProcess.APLProcess.UsingSystemDiagnostics</a></td><td></td><td>100</td><td>1</td></tr>
</tbody>
</table>
</div>
<script>
$(document).ready(function() {
    var oTable;
    oTable = $("#percent").DataTable( {
        paging:   false,
        ordering: true,
        info:     true,
        fixedHeader: true,
        order: [2,"asc"],
        dom: "Bft",
        drawCallback: function( settings ) {
             var api = this.api();
             $('.header[id^="listing_"]').next().addBack().css("display","none");
             api.rows( {page:"current"} ).data().each(function(data){
              id = data[0];
              id = id.match(/"(\#.*?)"/);
              if (id){$(id[1]).next().addBack().css("display","block");}
             })
        },      
        buttons: [
        {
            text: "Partly covered (7)",
            titleAttr: "50%",
            className: "active",
            action: function ( e, dt, node, config ) {
                var text = this.text();
                var search = "^(?!(0%|100%)).*";
                oTable.column(2)
                    .search(search,true,false,false)
                    .draw();
                $(".dt-buttons button").removeClass("active");
                this.active( true );
            }
        },
        {
            text: "Uncovered (5)",
            titleAttr: "0%",
            className: "active",
            action: function ( e, dt, node, config ) {
                var text = this.text();
                var search = "^0%";
                oTable.column(2)
                    .search(search,true,false,false)
                    .draw();
                $(".dt-buttons button").removeClass("active");
                this.active( true );
            }
        },
        {
            text: "Fully covered (15)",
            titleAttr: "100%",
            className: "active",
            action: function ( e, dt, node, config ) {
                var text = this.text();
                var search = "100%";
                oTable.column(2)
                    .search(search,true,false,false)
                    .draw();
                $(".dt-buttons button").removeClass("active");
                this.active( true );
            }
        },
        {
            text: "All (27)",
            titleAttr: "all",
            className: "active",
            action: function ( e, dt, node, config ) {
                var text = this.text();
                var search = ".";
                oTable.column(2)
                    .search(search,true,false,false)
                    .draw();
                $(".dt-buttons button").removeClass("active");
                this.active( true );
            }
        },
    ],
 
        columnDefs: [
            {className: "align-right", targets: [2,3]
            },
            {
                render: function ( data, type, row, meta ) {
                            return data+"%" ;        
                        },
                targets: 2
            }
        ]             
    } );
    oTable.button(0).trigger();

} );    
</script>
<h2>Listings</h2>
<code class="header" id="listing_1">#.APLProcess.APLProcess.set_Wait &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> set_Wait arg</code>
<code class="emphasize">→[1]  'Invalid argument'Assert arg.NewValue∊0 1</code>
<code class="emphasize">→[2]  _Wait←arg.NewValue</code>
</div>
<code class="header" id="listing_2">#.APLProcess.APLProcess.get_LogFilename &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←get_LogFilename</code>
<code class="emphasize">→[1]  r←Proc.LogFilename</code>
</div>
<code class="header" id="listing_3">#.APLProcess.APLProcess.History &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←History</code>
<code> [1]   :Access Public Shared</code>
<code> [2]      ⍝ * 0.8.0 from 2024-04-22</code>
<code> [3]      ⍝   * Packages updated</code>
<code> [4]      ⍝ * 0.7.1 from 2024-04-28</code>
<code> [5]      ⍝   * Killed the process even with Wait←0, meaning that the process was not running independently.</code>
<code> [6]      ⍝ * 0.7.0 from 2023-09-26</code>
<code> [7]      ⍝   * Now APLProcess can use .NET or .NET Framework (former version only worked with .NET Framework)</code>
<code> [8]      ⍝ * 0.6.0 from 2021-05-27</code>
<code> [9]      ⍝   * BREAKING CHANGE: the property `LogFilename` has been renamed: `OutputFilename`</code>
<code> [10]     ⍝   * With  `Wait←1` a return code is returned now</code>
<code> [11]     ⍝   * A parameter space is now copied rather than modified</code>
<code> [12]     ⍝   * Problems on Linux fixed</code>
<code> [13]     ⍝   * Problems on Mac-OS fixed accept when you need a Ride</code>
<code class="emphasize">→[14]  r←↑{⍵↓⍨+/∧\∧⌿(↑⍵)=' '}{⍵↓⍨⍵⍳'⍝'}¨{⍵/⍨'⍝'=⊃¨⍵}{⍵↓⍨+/∧\(↑⍵)=' '}¨1↓⎕NR⊃⎕SI Proc</code>
</div>
<code class="header" id="listing_4">#.APLProcess.APLProcess.GetLog &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←GetLog</code>
<code> [1]  :Access Public Instance</code>
<code class="emphasize">→[2]  r←''</code>
<code class="emphasize">→[3]  :If ⎕NEXISTS Proc.LogFilename</code>
<code class="emphasize">→[4]      r←⊃⎕NGET Proc.LogFilename</code>
<code> [5]  :EndIf</code>
</div>
<code class="header" id="listing_5">#.APLProcess.APLProcess.GetPID &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←GetPID</code>
<code> [1]  :Access Public Instance</code>
<code> [2]       ⍝ Get ID of the current process</code>
<code class="emphasize">→[3]  r←Proc.Id</code>
</div>
<code class="header" id="listing_6">#.APLProcess.APLProcess.Start &mdash; 29%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>   Start ps</code>
<code> [1]    :If 0=≢ps.Exe</code>
<code> [2]        ps.Exe←(GetRuntimeName⍣ps.Runtime)GetCurrentExecutable ⍝ else, deduce it</code>
<code> [3]    :EndIf</code>
<code> [4]    Exe←ps.Exe</code>
<code> [5]    ride←''</code>
<code> [6]    :If 0≠ps.RidePort</code>
<code class="emphasize">→[7]        ride←'RIDE_INIT="SERVE:*:',(⍕ps.RidePort),'" RIDE_SPAWNED=1 '</code>
<code> [8]    :Else</code>
<code> [9]        ride←'RIDE_INIT= '</code>
<code> [10]   :EndIf</code>
<code> [11]   args←ps.CommandLineArgs</code>
<code> [12]   args,←(0&lt;≢ps.OutputFilename)/' LOG_FILE="',ps.OutputFilename,'" '</code>
<code> [13]   output←(1+×≢OUT_FILE)⊃'/dev/null'OUT_FILE</code>
<code> [14]   Proc.LogFilename←(739⌶0),'/APLProcess-Logfile-',{⎕RL←+/⎕TS ⋄ ⍕?⍵}100000</code>
<code> [15]   :Select APLTreeUtils2.GetOperatingSystem ⍬</code>
<code> [16]   :Case 'Win'</code>
<code> [17]       :If ~ps.Runtime</code>
<code> [18]           :If (,0)≡,ps.SessionFile</code>
<code> [19]               args,←' session_file="" '</code>
<code> [20]           :ElseIf (,1)≡,ps.SessionFile</code>
<code> [21]               ps.SessionFile←GetDefaultDseFilename ps.Exe</code>
<code> [22]               args,←' session_file="',ps.SessionFile,'" '</code>
<code> [23]           :ElseIf ' '=1↑0⍴ps.SessionFile</code>
<code class="emphasize">→[24]               args,←' session_file="',ps.SessionFile,'" '</code>
<code> [25]           :Else</code>
<code class="emphasize">→[26]               'Invalid parameter: "SessionFile"'Assert 0</code>
<code> [27]           :EndIf</code>
<code> [28]       :EndIf</code>
<code> [29]       cmd←ps.Exe</code>
<code> [30]  </code>
<code> [31]       ⎕USING←UsingSystemDiagnostics</code>
<code> [32]            ⍝⎕USING←'System' 'System.IO' 'System.Diagnostics,System.Diagnostics.Process'</code>
<code> [33]       psi←⎕NEW Diagnostics.ProcessStartInfo,⊂ps.Exe(({0=≢⍵:⍵ ⋄ '"',(⍵~'"'),'" '}ps.WorkspaceName),args)</code>
<code> [34]       psi.WindowStyle←Diagnostics.ProcessWindowStyle.⍎ps.WindowsStyle</code>
<code> [35]       Proc←Diagnostics.Process.Start psi</code>
<code> [36]       :If ps.Wait</code>
<code> [37]           Proc.WaitForExit ⍬</code>
<code> [38]       :EndIf</code>
<code> [39]   :Case 'Lin'</code>
<code class="emphasize">→[40]       cmd←ride,' '</code>
<code class="emphasize">→[41]       :If ps.Wait</code>
<code class="emphasize">→[42]           cmd←'"',ps.Exe,'"'</code>
<code class="emphasize">→[43]           :If 0≠≢ride</code>
<code class="emphasize">→[44]               cmd,←' +s -q'</code>
<code> [45]           :EndIf</code>
<code class="emphasize">→[46]           cmd,←' "',(ps.WorkspaceName~'"'),'"'</code>
<code class="emphasize">→[47]           cmd,←' ',args</code>
<code class="emphasize">→[48]           :If ps.RidePort=0</code>
<code class="emphasize">→[49]               cmd,←' 0&lt;&amp;-'</code>
<code> [50]           :EndIf</code>
<code class="emphasize">→[51]           cmd,←' 1&gt;',output</code>
<code class="emphasize">→[52]           cmd,←,' 2&gt;',Proc.LogFilename</code>
<code class="emphasize">→[53]           :Trap 0</code>
<code class="emphasize">→[54]               Z←⎕SH cmd</code>
<code class="emphasize">→[55]               _ExitCode←0</code>
<code> [56]           :Else</code>
<code class="emphasize">→[57]               qdmx←⎕DMX</code>
<code class="emphasize">→[58]               _ExitCode←{{⊃⊃(//)⎕VFI⌽⍵↑⍨¯1+⍵⍳' '}⌽⍵}qdmx.Message</code>
<code> [59]           :EndTrap</code>
<code class="emphasize">→[60]           Proc.HasExited←1</code>
<code> [61]       :Else</code>
<code class="emphasize">→[62]           cmd←'{ ',ride</code>
<code class="emphasize">→[63]           cmd,←{0=≢⍵:⍵ ⋄ ⍵,' '}args</code>
<code class="emphasize">→[64]           cmd,←' "',ps.Exe,'"'</code>
<code class="emphasize">→[65]           :If 0≠≢ride</code>
<code class="emphasize">→[66]               cmd,←' +s -q'</code>
<code> [67]           :EndIf</code>
<code class="emphasize">→[68]           cmd,←' "',(ps.WorkspaceName~'"'),'"'</code>
<code class="emphasize">→[69]           :If ps.RidePort=0</code>
<code class="emphasize">→[70]               cmd,←' 0&lt;&amp;-'</code>
<code> [71]           :EndIf</code>
<code class="emphasize">→[72]           cmd,←' 1&gt;',output</code>
<code class="emphasize">→[73]           cmd,←,' 2&gt;',Proc.LogFilename</code>
<code class="emphasize">→[74]           cmd,←' &amp; }'</code>
<code class="emphasize">→[75]           cmd,←'; echo $!'</code>
<code class="emphasize">→[76]           pid←⎕SH cmd</code>
<code class="emphasize">→[77]           Proc.Id←⊃⊃(//)⎕VFI∊pid</code>
<code class="emphasize">→[78]           Proc.HasExited←0</code>
<code> [79]       :EndIf</code>
<code class="emphasize">→[80]       Proc.StartTime←⎕TS</code>
<code class="emphasize">→[81]   :Case 'Mac'</code>
<code class="emphasize">→[82]       cmd←ride,' '</code>
<code class="emphasize">→[83]       :If ps.Wait</code>
<code class="emphasize">→[84]           cmd,←'"',ps.Exe,'" '</code>
<code class="emphasize">→[85]           :If 0≠≢ride</code>
<code class="emphasize">→[86]               cmd,←' +s -q'</code>
<code> [87]           :EndIf</code>
<code class="emphasize">→[88]           cmd,←' "',(ps.WorkspaceName~' '),'"'</code>
<code class="emphasize">→[89]           cmd,←{0=≢⍵:⍵ ⋄ ' ',⍵}args</code>
<code class="emphasize">→[90]           :If ps.RidePort=0</code>
<code class="emphasize">→[91]               cmd,←' 0&lt;&amp;-'</code>
<code class="emphasize">→[92]               cmd,←' 1&gt;',output</code>
<code class="emphasize">→[93]               cmd,←,' 2&gt;',Proc.LogFilename</code>
<code> [94]           :Else</code>
<code class="emphasize">→[95]               'Riding into a runtime is not implemented yet'⎕SIGNAL 11</code>
<code> [96]           :EndIf</code>
<code class="emphasize">→[97]           :Trap 0</code>
<code class="emphasize">→[98]               Z←⎕SH cmd</code>
<code class="emphasize">→[99]               _ExitCode←0</code>
<code> [100]          :Else</code>
<code class="emphasize">→[101]              qdmx←⎕DMX</code>
<code class="emphasize">→[102]              _ExitCode←{{⊃⊃(//)⎕VFI⌽⍵↑⍨¯1+⍵⍳' '}⌽⍵}qdmx.Message</code>
<code> [103]          :EndTrap</code>
<code class="emphasize">→[104]          Proc.HasExited←1</code>
<code class="emphasize">→[105]          Proc.Id←0</code>
<code> [106]      :Else</code>
<code class="emphasize">→[107]          cmd←'{ ',cmd,' "',(ps.Exe~' '),'" "',(ps.WorkspaceName~' '),'" -c APLPPID=$PPID'</code>
<code class="emphasize">→[108]          :If ps.RidePort=0</code>
<code class="emphasize">→[109]              cmd,←' 0&lt;&amp;-'</code>
<code class="emphasize">→[110]              cmd,←' 1&gt;',output</code>
<code class="emphasize">→[111]              cmd,←,' 2&gt;',Proc.LogFilename</code>
<code class="emphasize">→[112]              cmd,←'} ; echo $!'</code>
<code> [113]          :Else</code>
<code class="emphasize">→[114]              'Riding into a runtime is not implemented yet'⎕SIGNAL 11/⍨ps.Runtime</code>
<code> [115]          :EndIf</code>
<code class="emphasize">→[116]          pid←⎕SH cmd</code>
<code class="emphasize">→[117]          Proc.Id←⊃⊃(//)⎕VFI∊pid</code>
<code class="emphasize">→[118]          Proc.HasExited←0</code>
<code> [119]      :EndIf</code>
<code class="emphasize">→[120]      Proc.StartTime←⎕TS</code>
<code> [121]  :EndSelect</code>
</div>
<code class="header" id="listing_7">#.APLProcess.APLProcess.GetCurrentExecutable &mdash; 38%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←GetCurrentExecutable</code>
<code> [1]   :If 'Win'≡APLTreeUtils2.GetOperatingSystem ⍬</code>
<code> [2]       r←''</code>
<code> [3]       'gmfn'⎕NA'U4 kernel32|GetModuleFileName* P =T[] U4'</code>
<code> [4]       r←⊃⍴/gmfn 0(1024⍴' ')1024</code>
<code> [5]       :If 0=≢r</code>
<code class="emphasize">→[6]           ⎕USING←UsingSystemDiagnostics</code>
<code class="emphasize">→[7]           r←2 ⎕NQ'.' 'GetEnvironment' 'DYALOG'</code>
<code class="emphasize">→[8]           r←r,(~(¯1↑r)∊'\/')/'/' ⍝ Add separator if necessary</code>
<code class="emphasize">→[9]           r←r,(Diagnostics.Process.GetCurrentProcess.ProcessName),'.exe'</code>
<code> [10]      :EndIf</code>
<code> [11]  :Else</code>
<code class="emphasize">→[12]      t←⊃1↓⎕SH'ps -o args -p $PPID'</code>
<code class="emphasize">→[13]      :If '"'''∊⍨⊃t  ⍝ if command begins with ' or "</code>
<code class="emphasize">→[14]          r←{⍵/⍨{∧\⍵∨≠\⍵}⍵=⊃⍵}t</code>
<code> [15]      :Else</code>
<code class="emphasize">→[16]          r←{⍵↑⍨¯1+1⍳⍨(¯1↓0,⍵='\')&lt;⍵=' '}t ⍝ otherwise find first non-escaped space (this will fail on files that end with '\\')</code>
<code> [17]      :EndIf</code>
<code> [18]  :EndIf</code>
</div>
<code class="header" id="listing_8">#.APLProcess.APLProcess.Version &mdash; 67%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←Version</code>
<code> [1]      ⍝ Returns the version number from `TatinVars` if possible.</code>
<code> [2]      ⍝ See also `History`</code>
<code> [3]   :Access Public Shared</code>
<code> [4]   :If 0&lt;##.⎕NC'TatinVars.CONFIG'</code>
<code> [5]       r←(⎕JSON⍠('Dialect' 'JSON5')⊢##.TatinVars.CONFIG).version</code>
<code> [6]   :Else</code>
<code> [7]      ⍝ When a script was not loaded with Tatin, there will be no namespace `TatinVars`.</code>
<code> [8]      ⍝ In such cases we cannot provide a version number, so we return just ''.</code>
<code class="emphasize">→[9]       r←''</code>
<code> [10]  :EndIf</code>
</div>
<code class="header" id="listing_9">#.APLProcess.APLProcess.get_ExitCode &mdash; 78%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←get_ExitCode</code>
<code> [1]   :If 0≠Proc.⎕NC⊂'ExitCode'</code>
<code> [2]       flag←0</code>
<code> [3]       :Repeat</code>
<code> [4]           :Trap 0</code>
<code> [5]               r←Proc.ExitCode</code>
<code> [6]               flag←1</code>
<code> [7]           :Else</code>
<code class="emphasize">→[8]               ⎕DL 0.2</code>
<code> [9]           :EndTrap</code>
<code> [10]      :Until flag</code>
<code> [11]  :Else</code>
<code class="emphasize">→[12]      r←_ExitCode</code>
<code> [13]  :EndIf</code>
</div>
<code class="header" id="listing_10">#.APLProcess.APLProcess.GetRuntimeName &mdash; 80%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←GetRuntimeName exe</code>
<code> [1]      ⍝ Assumes that:</code>
<code> [2]      ⍝ Windows runtime ends in "rt.exe"</code>
<code> [3]      ⍝ *NIX runtime ends in ".rt"</code>
<code> [4]   r←exe</code>
<code> [5]   :If 'Win'≡APLTreeUtils2.GetOperatingSystem ⍬</code>
<code> [6]       :If 'rt.exe'≢¯6↑{('rt.ex',⍵)[⍵⍳⍨'RT.EX',⍵]}exe ⍝ deal with case insensitivity</code>
<code> [7]           r←'rt.exe',⍨{(~∨\⌽&lt;\⌽'.'=⍵)/⍵}exe</code>
<code> [8]       :EndIf</code>
<code> [9]   :Else</code>
<code class="emphasize">→[10]      r←exe,('.rt'≢¯3↑exe)/'.rt'</code>
<code> [11]  :EndIf</code>
</div>
<code class="header" id="listing_11">#.APLProcess.APLProcess.SourcePath &mdash; 83%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  path←SourcePath</code>
<code> [1]      ⍝ Determine the source path of the class</code>
<code> [2]   :Trap 6</code>
<code> [3]       source←⍎'(⊃⊃⎕CLASS ⎕THIS).SALT_Data.SourceFile' ⍝ ⍎ works around a bug</code>
<code> [4]   :Else</code>
<code> [5]       :If 0=≢source←{((⊃¨⍵)⍳⊃⊃⎕CLASS ⎕THIS)⊃⍵,⊂''}5177⌶⍬</code>
<code class="emphasize">→[6]           source←⎕WSID</code>
<code> [7]       :Else</code>
<code> [8]           source←4⊃source</code>
<code> [9]       :EndIf</code>
<code> [10]  :EndTrap</code>
<code> [11]  path←{(-⌊/(⌽⍵)⍳'\/')↓⍵}source</code>
</div>
<code class="header" id="listing_12">#.APLProcess.APLProcess.make1 &mdash; 97%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  make1(y)</code>
<code> [1]   :Access Public Instance</code>
<code> [2]   :Implements Constructor</code>
<code> [3]        ⍝ `y` becomes either `parmspace` (if it is a namespace) or `commandline` (if it is a text vector).</code>
<code> [4]        ⍝ `parmSpace` is a parameter namespace, usually created by calling `CreateParms`; see there.</code>
<code> [5]        ⍝ `commandline` is a text vector that will be passed on the command line, like workspace name, `maxws=` etc.</code>
<code> [6]   make_common</code>
<code> [7]   :If 2=⎕NC'y'</code>
<code> [8]   :AndIf (≡y)∊0 1</code>
<code> [9]       'Invalid right argument'Assert{16::0 ⋄ 1⊢' '=1↑0⍴⍵}y</code>
<code> [10]  :AndIf ' '=1↑0⍴y</code>
<code> [11]      commandline←y</code>
<code> [12]      parmSpace←⍬</code>
<code> [13]  :ElseIf 0≡≡y</code>
<code> [14]  :AndIf 9=⎕NC'y'</code>
<code> [15]      parmSpace←⎕NS y</code>
<code> [16]      commandline←⍬</code>
<code> [17]  :Else</code>
<code class="emphasize">→[18]      'Invalid right argument: must be either a parameter space or a text vector (command line)'Assert 0</code>
<code> [19]  :EndIf</code>
<code> [20]  :If (⊂parmSpace)∊''⍬</code>
<code> [21]      parmSpace←CreateParms</code>
<code> [22]  :EndIf</code>
<code> [23]  :If ⍬≢commandline</code>
<code> [24]      buff←' '(≠⊆⊢)commandline</code>
<code> [25]      :If '-'≠1↑⊃buff</code>
<code> [26]      :AndIf ~'='∊⊃buff</code>
<code> [27]          parmSpace.WorkspaceName←⊃buff</code>
<code> [28]          buff←1↓buff</code>
<code> [29]      :EndIf</code>
<code> [30]      parmSpace.CommandLineArgs←1↓⊃,/' ',¨buff</code>
<code> [31]  :EndIf</code>
<code> [32]  'Invalid window style'Assert(⊂parmSpace.WindowsStyle)∊'Hidden' 'Maximized' 'Minimized' 'Normal'</code>
<code> [33]  :If 0&lt;≢parmSpace.Exe</code>
<code> [34]      ('The specified EXE cannot be found: ',parmSpace.Exe)Assert ⎕NEXISTS parmSpace.Exe</code>
<code> [35]  :EndIf</code>
<code> [36]  (RidePort OUT_FILE WorkspaceName Args _Wait)←parmSpace.(RidePort OutputFilename WorkspaceName CommandLineArgs Wait)</code>
<code> [37]  WorkspaceName~←'"'</code>
<code> [38]  :If 0&lt;≢WorkspaceName</code>
<code> [39]      ('The specified workspace cannot be found: ',WorkspaceName)Assert ⎕NEXISTS WorkspaceName</code>
<code> [40]  :EndIf</code>
<code> [41]  PATH←SourcePath</code>
<code> [42]  Start parmSpace</code>
</div>
<code class="header" id="listing_13">#.APLProcess.APLProcess.get_Wait &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←get_Wait</code>
<code> [1]  r←_Wait</code>
</div>
<code class="header" id="listing_14">#.APLProcess.APLProcess.set_WindowsStyle &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block missing">Could not get canonical representation.</div>
<code class="header" id="listing_15">#.APLProcess.APLProcess.get_WindowsStyle &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←get_WindowsStyle</code>
<code> [1]  r←_WindowsStyle</code>
</div>
<code class="header" id="listing_16">#.APLProcess.APLProcess.set_LogFilename &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block missing">Could not get canonical representation.</div>
<code class="header" id="listing_17">#.APLProcess.APLProcess.set_ExitCode &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block missing">Could not get canonical representation.</div>
<code class="header" id="listing_18">#.APLProcess.APLProcess.make_common &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> make_common</code>
<code> [1]  _WindowsStyle←WindowsStyleDefault</code>
<code> [2]  _ExitCode←¯1</code>
<code> [3]  OS←(⊃⊃⎕CLASS ⎕THIS).##.OS</code>
<code> [4]  APLTreeUtils2←(⊃⊃⎕CLASS ⎕THIS).##.APLTreeUtils2</code>
</div>
<code class="header" id="listing_19">#.APLProcess.APLProcess.Close &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> Close</code>
<code> [1]  :Access Public Instance</code>
<code> [2]  Close_</code>
</div>
<code class="header" id="listing_20">#.APLProcess.APLProcess.Close_ &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> Close_</code>
<code> [1]  :Implements Destructor</code>
<code> [2]  WaitForKill&amp;(5×Wait)0.2 ⍝ Start a new thread to do the dirty work</code>
</div>
<code class="header" id="listing_21">#.APLProcess.APLProcess.CreateParms &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←CreateParms</code>
<code> [1]   :Access Public Shared</code>
<code> [2]      ⍝ Creates a parameter namespace that will be accepted by the constructor.</code>
<code> [3]      ⍝ | Name             | Description |</code>
<code> [4]      ⍝ |------------------|-------------|</code>
<code> [5]      ⍝ | `CommandLineArg` | By default empty. Optional command line parameters passed to `Exe`. (Don't specify a session file here!)|</code>
<code> [6]      ⍝ | `Exe`            | Defaults to `''` which means that the same EXE is executed the instance was created from. Can also be a fully qualified name of the exe to be run.|</code>
<code> [7]      ⍝ | `OutputFilename` | By default empty, meaning that any output is thrown away. If this is specified it is expected to be the name of a file.|</code>
<code> [8]      ⍝ | `RidePort`       | By default 0 (no effect). When a positive integer &gt; 0 this is used as port number for `RIDE_INIT`.|</code>
<code> [9]      ⍝ | `Runtime`        | Boolean that defaults to 0. Is ignored in case `Exe` is not empty.|</code>
<code> [10]     ⍝ | `SessionFile`    | Defaults to 0 which means no session file is loaded. A 1 will load the default DSE file. May also be the fully qualified path to a DSE file.|</code>
<code> [11]     ⍝ | `Wait`           | Boolean that defaults to 1, meaning that APLProcess waits for the process to quit; 0 means it runs independently.|</code>
<code> [12]     ⍝ | `WindowStyle`    | Defaults to "Minimized". May be "Hidden" or "Maximized" or "Normal" instead. Is case sensitive!|</code>
<code> [13]     ⍝ | `WorkspaceName`  | By default empty; the fully qualified name of the workspace to be loaded.|</code>
<code> [14]  r←⎕NS''</code>
<code> [15]  r.CommandLineArgs←''</code>
<code> [16]  r.Exe←''</code>
<code> [17]  r.OutputFilename←''</code>
<code> [18]  r.RidePort←0</code>
<code> [19]  r.Runtime←0</code>
<code> [20]  r.SessionFile←0</code>
<code> [21]  r.WindowsStyle←WindowsStyleDefault</code>
<code> [22]  r.WorkspaceName←''</code>
<code> [23]  r.Wait←1</code>
<code> [24]  r.⎕FX'r←∆List;⎕IO' '⎕IO←⎕ML←1' 'r←{(⍵,[1.5]⎕nc¨⊂¨⍵),⍎¨⍵}(⊂''∆List'')~⍨⎕NL-2 9 3' ⍝ Vars, refs and niladic functions</code>
</div>
<code class="header" id="listing_22">#.APLProcess.APLProcess.WaitForKill &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  WaitForKill(limit interval)</code>
<code> [1]   :If 0&lt;≢Proc.⎕NL-2</code>
<code> [2]       :If ~{0::1 ⋄ ⍵.HasExited}Proc</code>
<code> [3]           count←0</code>
<code> [4]           :While ~Proc.HasExited</code>
<code> [5]               {}⎕DL interval</code>
<code> [6]               count←count+1</code>
<code> [7]           :Until (~Proc.HasExited)∧count&gt;limit</code>
<code> [8]           :AndIf ~Proc.HasExited</code>
<code> [9]                ⍝ OK, force has to be used</code>
<code> [10]          :Trap 11</code>
<code> [11]              {}OS.KillPID Proc.Id</code>
<code> [12]          :EndTrap</code>
<code> [13]      :EndIf</code>
<code> [14]  :EndIf</code>
</div>
<code class="header" id="listing_23">#.APLProcess.APLProcess.HasExited &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←HasExited</code>
<code> [1]  :Access Public Instance</code>
<code> [2]       ⍝ Boolean that is 1 if and only if the process started by `APLProcess` has stopped running.</code>
<code> [3]       ⍝ Under Windows .NET tells us. On non-Windows platforms we need to check</code>
<code> [4]  r←0=≢Proc.Id OS.GetTaskList 0 0 0</code>
</div>
<code class="header" id="listing_24">#.APLProcess.APLProcess.KillItself &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> {success}←KillItself</code>
<code> [1]  :Access Public Instance</code>
<code> [2]     ⍝ Attempts to stop the process.\\</code>
<code> [3]     ⍝ `success` is 1 in case the process could be stopped, otherwise 0.</code>
<code> [4]  success←0</code>
<code> [5]  pid←Proc.Id</code>
<code> [6]  success←~OS.KillPID pid</code>
</div>
<code class="header" id="listing_25">#.APLProcess.APLProcess.GetDefaultDseFilename &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←GetDefaultDseFilename exe</code>
<code> [1]  name←{⍵↑⍨1+-⌊/(⌽⍵)⍳'/\'}2 ⎕NQ #'GetEnvironment' 'Session_file'</code>
<code> [2]  path←{⍵↓⍨1+-⌊/(⌽⍵)⍳'/\'}exe</code>
<code> [3]  r←path,name</code>
</div>
<code class="header" id="listing_26">#.APLProcess.APLProcess.IsNetCore &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←IsNetCore</code>
<code> [1]  :Access public shared</code>
<code> [2]  r←(,'1')≡,2 ⎕NQ'.' 'GetEnvironment' 'DYALOG_NETCORE'</code>
</div>
<code class="header" id="listing_27">#.APLProcess.APLProcess.UsingSystemDiagnostics &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←UsingSystemDiagnostics</code>
<code> [1]  :Access public shared</code>
<code> [2]  r←(1+IsNetCore)⊃'System,System.dll' 'System,System.Diagnostics.Process'</code>
</div>
<div id="footer">
<hr>
<p>Created by "CodeCoverage" version 0.10.7+52 from 2024-06-05</p>
</div>

</body>
</html>
